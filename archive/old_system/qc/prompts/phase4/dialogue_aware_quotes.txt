You are extracting quotes and speakers from a FOCUS GROUP INTERVIEW with dialogue structure analysis.

INTERVIEW: {interview_id}  
ANALYTIC QUESTION: {analytic_question}
FOCUS GROUP: {speaker_count} participants in conversational setting

AVAILABLE CODES (from Phase 1):
{formatted_codes}

SPEAKER PROPERTIES TO EXTRACT (from Phase 2):
{formatted_speaker_schema}

CRITICAL INSTRUCTIONS FOR FOCUS GROUP QUOTE EXTRACTION:

1. SELECTIVE EXTRACTION WITH DIALOGUE CONTEXT:
   - ONLY extract quotes that clearly relate to one or more of the codes above
   - Each quote MUST map to at least one code from the taxonomy  
   - Focus on substantive exchanges that address the analytic question
   - Consider how speakers build on, challenge, or respond to each other
   - Quality over quantity - meaningful quotes with codes and connections

2. CODE APPLICATION (MANDATORY):
   - CRITICAL: Use EXACT CODE IDs shown in brackets [CODE_ID] above
   - Each quote MUST have at least one code_id from the taxonomy
   - Many quotes relate to MULTIPLE codes - apply all that fit
   - If a statement doesn't map to any code, don't extract it as a quote
   
   CORRECT EXAMPLES using actual codes:
   {code_examples}
   
   WRONG: Do NOT make up new IDs like "accuracy_concerns"

3. THEMATIC CONNECTION ANALYSIS (FOCUS GROUP PRIORITY):

   THEMATIC CONNECTION GUIDELINES:
   - Be conservative - only identify clear, obvious thematic relationships
   - Most quotes (40-70%) should have "none" connections - this is normal and expected
   - Thematic connections are for significant relationships between coded content
   - Better to miss a subtle connection than create a false one
   - Look for relationships between themes/codes, not just conversational sequence

   EXPECTED CONNECTION RATES:
   - Typical focus groups: 30-60% of quotes have thematic connections
   - 40-70% should have "none" connections
   - If assigning connections to >80% of quotes, you are likely over-connecting

   FOCUS ON THEMATIC RELATIONSHIPS:
   - Connect quotes that develop, support, or challenge the same themes/codes
   - A speaker can connect to their own previous quotes about the same theme
   - Self-connections are valid for thematic development within speaker's coded content
   - Prioritize relationships between coded themes over conversational flow

   - Speech act types to identify:
     * "builds_on": extends or develops a previous speaker's idea
     * "challenges": disagrees with or questions a previous point  
     * "clarifies": explains or provides detail on a previous statement
     * "supports": agrees with or reinforces a previous speaker
     * "responds_to": directly addresses a previous speaker's point
     * "contradicts": directly opposes a previous speaker's viewpoint
     * "none": no clear thematic connection to previous speakers
   
   - Connection indicators to look for:
     * Explicit references: "Yes, but...", "Building on that...", "I disagree with Sarah..."
     * Implicit thematic continuation: similar topics, contrasting viewpoints
     * Sequential development: problem → solution, question → answer
   
   VALID THEMATIC CONNECTION EXAMPLES:
   - Quote 1 (Alice): "AI has reliability issues" [AI_CHALLENGES_AND_RISKS]
   - Quote 2 (Alice): "We need validation to address reliability" [VALIDATION_NEEDS]
   - Connection: Quote 2 "builds_on" Quote 1 (same speaker, related themes)
   
   WHEN TO USE "NONE":
   - Quote doesn't clearly relate to previous coded themes
   - Stands alone as independent observation
   - Uncertain or weak thematic relationship
   - Better to be conservative than over-connect
   
   - Confidence scoring guidelines (metadata only):
     * 0.9+: Explicit name reference or clear connecting phrase
     * 0.7+: Clear thematic continuation without explicit reference  
     * 0.5+: Subtle topical connection or implied relationship
     * Use "none" when connection is uncertain or unclear

4. QUOTE BOUNDARIES AND LOCATION:
   - Capture complete thoughts with sufficient context
   - Use natural semantic boundaries (complete sentences/thoughts)
   - Include speaker attribution markers when present: [Speaker Name]
   - Location tracking:
     * Set location_start/end based on conversation sequence
     * Use sequence numbers when available
     * Ensure quotes can be traced back to conversational flow

5. SPEAKER IDENTIFICATION IN FOCUS GROUPS:
   - Identify speakers from text markers: [Speaker Name] or similar
   - Track speaker consistency across the conversation
   - For each speaker property: extract if clearly stated, use null if not mentioned
   - Note conversational roles: questioner, responder, facilitator, etc.

FOCUS GROUP CONTENT (with speaker markers):
{interview_text}

Return a JSON object with:
- quotes: array of quote objects with dialogue analysis
- speakers: array of speaker objects with conversation roles
- total_quotes: integer count  
- total_codes_applied: integer count
- thematic_connections_detected: integer count of quotes that have thematic connections (not "none")

Each quote object MUST include:
- text: exact quote text (string)
- speaker_name: speaker identifier (string)
- code_ids: array of code IDs from taxonomy (required, non-empty)
- location_start: sequence position or line number (integer or null)
- location_end: sequence end position (integer or null)  
- location_type: "sequence" or "line" or null
- thematic_connection: speech act type or "none" (string)
- connection_target: target speaker name or null (string or null)
- connection_confidence: 0.0-1.0 score or null (float or null)
- connection_evidence: brief connecting phrase or null (string or null)

Each speaker object MUST include:
- name: speaker's name or identifier (string)
- confidence: identification confidence 0.0-1.0 (float)
- identification_method: "dialogue_analysis" or method used (string)
- quotes_count: number of quotes from this speaker (integer)
- conversational_role: role in discussion or null (string or null)
